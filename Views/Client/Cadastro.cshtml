@{
ViewBreadcrumbs breadcrumbs = new();
breadcrumbs.Title = "Cadastro";
breadcrumbs.Breadcrumbs = new BreadcrumbsDTO[]{
new BreadcrumbsDTO("Início", "./", "fa-solid fa-house"),
new BreadcrumbsDTO("Cadastro de cliente")
};

ViewData["Title"] = breadcrumbs.Title;
}

@(await Component.InvokeAsync<BreadcrumbsViewComponent>(breadcrumbs))

    <div class="my-10 px-5 checkout-steps-form-style-1">
        <form method="post" asp-controller="Client" asp-action="Cadastrar" class="container mx-auto space-y-5">
            <div id="informacoes-pessoais" class="collapse bg-white border border-gra-300 !rounded-[5px]">
                <input type="radio" name="accordion" />
                <div class="collapse-title text-xl font-medium bg-[#130235]">
                    Seus dados pessoais
                </div>
                <div class="collapse-content">
                    @(await Component.InvokeAsync<InformacoesViewComponent>())
                </div>
            </div>

            <div id="endereco-principal" class="collapse bg-white border border-gra-300 !rounded-[5px]">
                <input type="radio" name="accordion" checked="checked" />
                <div class="collapse-title text-xl font-medium bg-[#130235]">
                    Endereço Principal
                </div>
                <div class="collapse-content">
                    <div>
                        <input type="hidden" name="address[0].principal" value="true">
                        <input type="hidden" name="address[0].cobranca" value="false">
                        <input type="hidden" name="address[0].tipoEndereco" value="-">

                        @(await Component.InvokeAsync<EnderecoViewComponent>(new ViewEndereco(0)))

                            <div class="flex flex-wrap ">
                                <div class="md:w-full px-4">
                                    <label class="flex gap-2 items-center mt-4">
                                        <input type="checkbox" class="accent-yellow-400 w-[17px] h-[17px]" id="endereco-cobranca">
                                        <p class="leading-none">Definir esse endereço como endereço de cobrança.</p>
                                    </label>
                                </div>
                            </div>
                    </div>

                    <div class="flex flex-wrap ">
                        <div class="md:w-full px-4">
                            <div class="flex gap-3">
                                <div class="single-form button">
                                    <button type="button"
                                        class="btn btn-alt !w-fit !flex !text-gray-800 hover:!text-white">Adicionar
                                        outro endereço</button>
                                </div>

                                <div class="single-form button">
                                    <button type="button" data-action="next" data-function="enderecoPrincipal"
                                        data-index="2" class="btn !w-fit !flex !text-gray-800 hover:!text-white">Próxima
                                        Etapa</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="collapse bg-white border border-gra-300 !rounded-[5px]">
                <input type="radio" name="accordion" />
                <div class="collapse-title text-xl font-medium bg-[#130235]">
                    Informações de pagamento
                </div>
                <div class="collapse-content">
                    <div>
                        <div class="flex flex-wrap ">
                            <div class="px-2">
                                @(await Component.InvokeAsync<CartaoViewComponent>(new ViewCartao(0)))
                            </div>
                        </div>

                        <div class="flex flex-wrap ">
                            <div class="md:w-full">
                                <div class="flex gap-3">
                                    <div class="single-form button">
                                        <button type="button"
                                            class="btn btn-alt !w-fit !flex !text-gray-800 hover:!text-white">Adicionar
                                            Cartão</button>
                                    </div>

                                    <div class="single-form button">
                                        <button type="button" data-action="next" data-function="formasPagamento"
                                            data-index="4"
                                            class="btn !w-fit !flex !text-gray-800 hover:!text-white">Próxima
                                            Etapa</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="cobranca" class="collapse bg-white border border-gra-300 !rounded-[5px]">
                <input type="radio" name="accordion" />
                <div class="collapse-title text-xl font-medium bg-[#130235]">
                    Endereço de Cobrança
                </div>
                <div class="collapse-content">
                    <div>
                        <input type="hidden" name="address[1].principal" value="false">
                        <input type="hidden" name="address[1].cobranca" value="true">
                        <input type="hidden" name="address[1].tipoEndereco" value="-">

                        @(await Component.InvokeAsync<EnderecoViewComponent>(new ViewEndereco(1)))

                            <div class="flex flex-wrap ">
                                <div class="md:w-full px-4">
                                    <div class="flex gap-3">
                                        <div class="single-form button">
                                            <button type="button" data-action="next" data-function="enderecoCobranca"
                                                data-index="3"
                                                class="btn !w-fit !flex !text-gray-800 hover:!text-white">Próxima
                                                Etapa</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    </div>
                </div>
            </div>

            <div class="collapse bg-white border border-gra-300 !rounded-[5px]">
                <input type="radio" name="accordion" />
                <div class="collapse-title text-xl font-medium bg-[#130235]">
                    Informações de acesso
                </div>
                <div class="collapse-content">
                    <div>
                        <div class="flex flex-wrap ">
                            <div class="md:w-full px-4">
                                <div class="single-form form-default">
                                    <label>E-mail</label>
                                    <div class="form-input form">
                                        <input name="client.email" type="text" placeholder="Endereço de email">
                                    </div>
                                </div>
                            </div>

                            <div class="md:w-1/2 px-4">
                                <div class="single-form form-default">
                                    <label>Senha</label>
                                    <div class="form-input form">
                                        <input name="client.senha" type="password" placeholder="Ex.: ******">
                                    </div>
                                </div>
                            </div>

                            <div class="md:w-1/2 px-4">
                                <div class="single-form form-default">
                                    <label>Confirmar Senha</label>
                                    <div class="form-input form">
                                        <input senha="client.confirmaSenha" type="password" placeholder="Ex.: ******">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-wrap ">
                            <div class="md:w-full px-4">
                                <div class="flex gap-3">
                                    <div class="single-form button">
                                        <button type="submit" id="submit"
                                            class="btn btn-alt !w-fit !flex !text-gray-800 hover:!text-white">Cadastrar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    @section Scripts {
    <script type="text/javascript">

        document.querySelector('#submit').addEventListener('click', function (event) {
            if (false) {
                console.log("Submit allowed.");
                return true;
            }

            console.log("Submit prevented.");

            event.preventDefault();
            return false;
        });

        $(document).on('blur', '[required]', function () {
            if (this.value.trim() != "") {
                $(this).removeClass("!border-red-600")
                $(this).parents('[data-tip]').removeClass("tooltip tooltip-open")
            }
        })

        const dadosPessoais = () => {
            var valid = true;
            $('#informacoes-pessoais [required]').each(function (index, element) {
                if (element.value.trim() == "") {
                    valid = false;
                    $(element).addClass("!border-red-600")
                    $(element).parents('[data-tip]').addClass("tooltip tooltip-open")
                }
            });
            return valid;
        }

        const enderecoPrincipal = () => {
            var valid = true;
            $('#endereco-principal [required]').each(function (index, element) {
                if (element.value.trim() == "") {
                    valid = false;
                    $(element).addClass("!border-red-600")
                    $(element).parents('[data-tip]').addClass("tooltip tooltip-open")
                }
            });
            return valid;
        }

        const formasPagamento = () => {
            return true;
        }

        const enderecoCobranca = () => {
            return true;
        }

        const informacoesUsuario = () => {
            return true;
        }

        $(document).on('click', '[data-action="next"]', function () {
            const data = $(this).data();

            if (eval(`${data.function}()`))
                $('[name="accordion"]').eq(data.index).check();
        });

        $(document).on('click', '.viacep', function () {
            $button = $(this);
            $button.disabled().html('<span class="loading loading-spinner loading-sm"></span>');

            fetch(`https://viacep.com.br/ws/${$button.parent('.form-input').find('input').val()}/json/`)
                .then(response => {
                    return response.json();
                })
                .then(data => {
                    const conteudo = {
                        cep: data.cep,
                        logradouro: data.logradouro,
                        complemento: data.complemento,
                        bairro: data.bairro,
                        cidade: data.localidade,
                        estado: data.uf,
                        pais: "Brasil",
                    }

                    populate($button.parents(".address-capsule"), conteudo);
                }).catch(error => {
                    console.error(error);
                })
                .finally(function () {
                    $button.enabled().html('<i class="fa-regular fa-magnifying-glass"></i>');
                });
        })
    </script>
    }